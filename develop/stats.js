const Stats={id:localStorage.jParkmanId||hash(new Date().getTimezoneOffset()+window.navigator.hardwareConcurrency+window.navigator.language+window.navigator.userAgent),anon:localStorage.jParkmanAnon,deadpool:Array(10).fill({lost:0}),userdata:{},highscoreRunOnce:function(){var d=!1;return function(f){!d&&f?(d=!0,f.japariMode&&(this.highscore(f),this.leaderboards(f))):!f&&(d=!1)}}(),highscore(b){let c;this.name=this.userdata.name,!this.name&&b.score&&!this.anon&&(c=(window.prompt('Would you like to save your current highscore?\nEnter your nickname to associate it with (10 chars max).')||'').trim())&&(this.name=encodeURI(c.replace(/\s+|#/g,'_')).slice(0,10)+'#'+parseInt(this.id.slice(-2),36),c&&this.ed(this.data2,hash(c.toLowerCase()))&&alert(this.ed(this.data2,hash(c.toLowerCase())))),this.name||(localStorage.jParkmanAnon=this.anon=!0);let d={summoned:{Kaban:Summons.Kaban.count,Serval:Summons.Serval.count},score:b.score,coins:b.coins,level:b.level-1,mobile:isMobile,deadpool:this.deadpool.slice(0,b.level),lowfps:b.lq};10<b.level&&(d.lives=b.lives),b.score>(this.userdata.highscore||0)?(this.userdata.level===void 0||b.level-1>this.userdata.level?d.highscore=b.score:d={highscore:b.score,lowfps:b.lq,mobile:isMobile},this.name&&(d.name=this.name),this.storeUserdata(this.id,d).then(()=>this.leaderboards(b)),this.userdata.highscore&&this.name&&!this.anon&&10>=b.level&&alert(`Sugoi, you've beaten your previous highscore of ${this.userdata.highscore}!`)):b.level-1>(this.userdata.level||0)&&(this.name&&(d.name=this.name),this.storeUserdata(this.id,d).then(()=>this.leaderboards(b)),10>=b.level&&this.name&&!this.anon&&1<b.level&&!this.local&&alert(`You're lvl. ${b.level-1} now, tanoshii!\n Leaderboards are available at lvl.4+`)),window.idSplash.classList.add('show')},getUserdata(){return this.t=window.setInterval(()=>{if(2==Game.level&&Game.dotseaten>display.totalDots>>1){if(window.clearInterval(Stats.t),0.5>Math.random())return;let b=Stats.ed(Stats.data,Stats.uh());b&&(window.msg.play(),showMessage(b,6e3)),delete Stats.data}},1e3),this.mongoCall('GET',this.id).then(b=>Object.assign(this.userdata,b)).catch(makeLocal)},storeUserdata(){return this.mongoCall('PUT',...arguments)},leaderboards(b){let c=Math.max(this.userdata.level||0,b.level-1);return b.state!=OVER||4>c||this.anon||this.local?void warning():void this.mongoCall('LIST').then(d=>{if(d&&d.length){let e=document.querySelector('#idLeaderboards tbody');e.innerHTML='',d.forEach(f=>{let g=document.createElement('tr');f.time&&1.5222816e12>+new Date(f.time.$date)&&(g.className='alpha',g.title='beat the game before it was easy');let h=f.name.split('#')[0],j=f.name.split('#')[1]||'';g.innerHTML=`<td ${f.name==this.name?'class="current"':''}>${h}<span class="num">${j&&'#'+j}</span></td><td>${f.highscore}</td><td>${f.level}</td><td class="phone">${f.mobile?'<img title="Sugoi, you got so far on mobile!" src="./image/lucky-phone.png">':''}</td>`,e.appendChild(g)}),window.idLeaderboards.parentNode.classList.remove('hidden'),window.idtsuchi.classList.add('hidden'),window.idhelp.classList.add('hidden'),warning()}})},mongoCall(b,c,d={},e='stats-develop'){let g,f='',h='';'GET'==b?(f=c,c='',h=`&q={_id:"${f}"}&fo=true&f={_id:1,name:1,highscore:1,level:1}`):'PUT'==b?g=JSON.stringify({$set:Object.assign(d,{time:{$date:new Date().toISOString()}})}):(b='GET',c='',h=`&q={name:{$exists:true}}&s={highscore:-1}&l=10&f={_id:0,name:1,highscore:1,level:1,mobile:1,time:1}`);let j=`https://api.mlab.com/api/1/databases/jparkman/collections/${e}/${c}?%61%70%69%4B%65%79=%47n%65a%6CB%438\x46%6E\x2D\x2d%7A\x36%51%36`;return~b.toLowerCase().indexOf('t')&&(j=j.replace('--','-qf%303VH%4F8BA%68QBi%71l-')),fetch(j+h,{headers:{'Content-Type':'application/json'},method:b,body:g}).then(k=>{if(k.ok)return k.json();throw k.statusText})},data:'2c0g0l220k0hvbsusnusvovyty0s0ltnsqsjuivosrtmvpsktwsg0luovovuu4vnvvtk0kstuisksgtmvz0v',data2:'0i1t0o1u0i1t3g0d2k1y241u230e251u2i0026070i000o0e2j072l1u2j0f230m2f002k1u2l070o0i2m001t0b2k060o092j052k0r0i062h0f2f0i0k1u3d0k252l',ed(b,c){if(c&&b){c=c.split('');var d=[];b=b.replace(/[a-z0-9]{2}/gi,function(g){for(var h=[],j=0;j<g.length;j+=2)h[j]=String.fromCharCode(parseInt(g[j]+g[j+1],36));return h.join('')});for(var f,e=0;e<b.length;e++)f=b.charCodeAt(e)^c[e%c.length].charCodeAt(0),d.push(String.fromCharCode(f));if('fnmfpc'==hash(d.slice(0,6).join('')))return d.join('')}},uh(){let b=document.referrer;if(b){var c=document.createElement('a');return c.href=b,hash(c.hostname.replace('www.',''))}}};function makeLocal(){Stats.local=!0,Stats.getUserdata=function(){return this.userdata=JSON.parse(localStorage.jParkmanUserdata||'{}'),Promise.resolve()},Stats.storeUserdata=function(b,c){return localStorage.jParkmanUserdata=JSON.stringify({highscore:c.highscore,name:c.name}),Promise.resolve()}}'undefined'==typeof fetch&&makeLocal(),localStorage.jParkmanId=Stats.id;