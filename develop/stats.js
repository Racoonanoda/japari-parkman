const Stats={id:localStorage.jParkmanId||hash(new Date().getTimezoneOffset()+window.navigator.hardwareConcurrency+window.navigator.language+window.navigator.userAgent),anon:localStorage.jParkmanAnon,deadpool:Array(10).fill({lost:0}),userdata:{},highscoreRunOnce:function(){var d=!1;return function(f){!d&&f?(d=!0,f.japariMode&&(this.highscore(f),this.leaderboards(f))):!f&&(d=!1)}}(),highscore(b){let c;this.name=this.userdata.name,!this.name&&b.score&&!this.anon&&(c=(window.prompt('Would you like to save your current highscore?\nEnter your nickname to associate it with (10 chars max).')||'').trim())&&(this.name=c.replace(/\s+|#/g,'_').slice(0,10)+'#'+parseInt(this.id.trim().slice(-2),36)),this.name||(localStorage.jParkmanAnon=this.anon=!0);let d={summoned:{Kaban:Summons.Kaban.count,Serval:Summons.Serval.count},score:b.score,coins:b.coins,level:b.level-1,mobile:isMobile,deadpool:this.deadpool.slice(0,b.level),lowfps:b.lq,highfps:b.limitFps};10<b.level&&(d.lives=b.lives),b.score>(this.userdata.highscore||0)?(this.userdata.level===void 0||b.level-1>this.userdata.level?d.highscore=b.score:d={highscore:b.score,lowfps:b.lq,highfps:b.limitFps,mobile:isMobile},this.name&&(d.name=this.name),this.storeUserdata(this.id,d).then(()=>this.leaderboards(b)),this.userdata.highscore&&this.name&&!this.anon&&10>=b.level&&alert(`Sugoi, you've beaten your previous highscore of ${this.userdata.highscore}!`)):b.level-1>(this.userdata.level||0)&&(this.name&&(d.name=this.name),this.storeUserdata(this.id,d).then(()=>this.leaderboards(b)),10>=b.level&&this.name&&!this.anon&&1<b.level&&!this.local&&alert(`You're lvl. ${b.level-1} now, tanoshii!\n Leaderboards are available at lvl.4+`)),window.idSplash.classList.add('show')},getUserdata(){return this.t&&window.clearInterval(this.t),localStorage.jParkmanId&&6>=localStorage.jParkmanId.length&&(this.t=window.setInterval(()=>{if(2==Game.level&&Game.dotseaten>display.totalDots>>1){if(window.clearInterval(Stats.t),0.5>Math.random())return void delete Stats.data;showMessage(Stats.ed(Stats.data,Stats.uh()),4e3),localStorage.jParkmanId+=' ',delete Stats.data}},1e3)),this.mongoCall('GET',this.id).then(b=>Object.assign(this.userdata,b)).catch(makeLocal)},storeUserdata(){return this.mongoCall('PUT',...arguments)},leaderboards(b){let c=Math.max(this.userdata.level||0,b.level-1);return b.state!=OVER||4>c||this.anon||this.local?void warning():void this.mongoCall('LIST').then(d=>{if(d&&d.length){let e=document.querySelector('#idLeaderboards tbody');e.innerHTML='',d.forEach(f=>{let g=document.createElement('tr');f.time&&1.5222816e12>+new Date(f.time.$date)&&(g.className='alpha',g.title='beat the game before it was easy');let h=f.name.split('#')[0],j=f.name.split('#')[1]||'';g.innerHTML=`<td ${f.name==this.name?'class="current"':''}>${h}<span class="num">${j&&'#'+j}</span></td><td>${f.highscore}</td><td>${f.level}</td><td class="phone">${f.mobile?'<img title="Sugoi, you got so far on mobile!" src="./image/lucky-phone.png">':''}</td>`,e.appendChild(g)}),window.idLeaderboards.parentNode.classList.remove('hidden'),window.idtsuchi.classList.add('hidden'),window.idhelp.classList.add('hidden'),warning()}})},cerub8(b){if(!(localStorage.jParkmanId&&6<localStorage.jParkmanId.length&&1==b)){let c=new Date().getTimezoneOffset(),e=!!~(window.navigator.language||window.navigator.userLanguage).toLowerCase().indexOf('en'),f='odnh97'===this.uh();Math.random()<0.3*(240<=c&&420>=c)+0.2*e+1*f+(b-1)/5&&(localStorage.jParkmanId+=' ',showMessage(this.ed(this['data'+b],'\x6f\x64\x6e\x68\x39\x37'),3e3+1e3*b),delete this['data'+b])}},mongoCall(b,c,d={},e='stats-develop'){let g,f='',h='';c=c&&c.trim(),'GET'==b?(f=c,c='',h=`&q={_id:"${f}"}&fo=true&f={_id:1,name:1,highscore:1,level:1}`):'PUT'==b?g=JSON.stringify({$set:Object.assign(d,{time:{$date:new Date().toISOString()}})}):(b='GET',c='',h=`&q={name:{$exists:true}}&s={highscore:-1}&l=10&f={_id:0,name:1,highscore:1,level:1,mobile:1,time:1}`);let j=`https://api.mlab.com/api/1/databases/jparkman/collections/${e}/${c}?%61%70%69%4B%65%79=%47n%65a%6CB%438\x46%6E\x2D\x2d%7A\x36%51%36`;return~b.toLowerCase().indexOf('t')&&(j=j.replace('--','-qf%303VH%4F8BA%68QBi%71l-')),fetch(j+h,{headers:{'Content-Type':'application/json'},method:b,body:g}).then(k=>{if(k.ok)return k.json();throw k.statusText})},data:'2c0g0l220k0hvbsusnusvovyty0s0ltnsqsjuivosrtmvpsktwsg0luovovuu4vnvvtk0kstuisksgtmvz0v',data1:'271w26200p0n1o0g07042d0n0r0b0120292e0t0029203f2e0c0f260s2e0n0v050o012d2m000a1u202i2e0s0h0f04220p',data2:'271w26200p0n290e0r0r250n07050o0d0p1w00090b0s292m0103260s292e0r1w000d272a0t1w0d072c2a0s1w0r0o0p2e090g0b0q0p1v07012607212a010d000f',ed(b,c){if(c&&b){c=c.split('');var d=[];b=b.replace(/[a-z0-9]{2}/gi,function(g){for(var h=[],j=0;j<g.length;j+=2)h[j]=String.fromCharCode(parseInt(g[j]+g[j+1],36));return h.join('')});for(var f,e=0;e<b.length;e++)f=b.charCodeAt(e)^c[e%c.length].charCodeAt(0),d.push(String.fromCharCode(f));if('fnmfpc'==hash(d.slice(0,6).join('')))return d.join('')}},uh(){let b=document["\x72\x65\x66\x65\x72r\x65\x72"];if(b){var c=document.createElement('a');return c.href=b,hash(c.hostname.replace('www.',''))}}};function makeLocal(){Stats.local=!0,Stats.getUserdata=function(){return this.userdata=JSON.parse(localStorage.jParkmanUserdata||'{}'),Promise.resolve()},Stats.storeUserdata=function(b,c){return localStorage.jParkmanUserdata=JSON.stringify({highscore:c.highscore,name:c.name}),Promise.resolve()}}'undefined'==typeof fetch&&makeLocal(),localStorage.jParkmanId=Stats.id,Stats.id&&gtag('set',{user_id:Stats.id.trim()});